# üîê –ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å –∏ Offline Mode

## –û–±–∑–æ—Ä —Ñ—É–Ω–∫—Ü–∏–π

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏ –∏ —Ä–∞–±–æ—Ç—ã –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞:

### üåê Offline Mode (–†–∞–±–æ—Ç–∞ –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞)

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –±–ª–∞–≥–æ–¥–∞—Ä—è:
- **IndexedDB** - –ª–æ–∫–∞—Ä–º–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤—Å–µ—Ö –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **Automatic caching** - –≤—Å–µ API –∑–∞–ø—Ä–æ—Å—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –¥–ª—è offline –¥–æ—Å—Ç—É–ø–∞
- **Background sync** - –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
- **Smart fallback** - –µ—Å–ª–∏ —Å–µ—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

#### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–≤—ã–π —Ä–∞–∑ –∑–∞–≥—Ä—É–∑–∏—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
2. –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ
3. –ü—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∫—ç—à–µ–º
4. –ü—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è

### üîí Privacy Mode (–ü—Ä–∏–≤–∞—Ç–Ω—ã–π —Ä–µ–∂–∏–º)

–í–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –æ—Ç–∫–ª—é—á–∞–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏ —É–¥–∞–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ:

#### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
- ‚ùå –ù–∏–∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ localStorage (—Ç–æ–ª—å–∫–æ sessionStorage)
- üîê –í—Å–µ –¥–∞–Ω–Ω—ã–µ —à–∏—Ñ—Ä—É—é—Ç—Å—è –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
- üö´ –û—Ç–∫–ª—é—á–∞—é—Ç—Å—è –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è (utm_*, fbclid –∏ —Ç.–¥.)
- üßπ –ü—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–∏–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª—è—é—Ç—Å—è
- üì° –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç—Å—è User-Agent –∏ –¥—Ä—É–≥–∏–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã

#### –ö–∞–∫ –≤–∫–ª—é—á–∏—Ç—å:
1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É üîê –≤–Ω–∏–∑—É —Å–ø—Ä–∞–≤–∞ —ç–∫—Ä–∞–Ω–∞
2. –í—ã —É–≤–∏–¥–∏—Ç–µ –ø–∞–Ω–µ–ª—å —Å –æ–ø—Ü–∏—è–º–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ toggle –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è/–æ—Ç–∫–ª—é—á–µ–Ω–∏—è

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API

### Offline Library

```javascript
import { 
    initOfflineDB,
    cacheForOffline,
    getOfflineData,
    queueForSync,
    isOnline,
    addOnlineListener,
    getOfflineStats,
    clearOfflineDB
} from './lib/offline';

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å offline DB (–¥–µ–ª–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ App.jsx)
await initOfflineDB();

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
console.log(isOnline()); // true/false

// –°–ª—É—à–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
addOnlineListener((isOnline) => {
    console.log(isOnline ? 'üåê Online' : 'üì° Offline');
});

// –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫—ç—à–∞
const stats = await getOfflineStats();
console.log(stats); // { cached: 10, syncing: 2, size: 10240 }

// –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ cached –¥–∞–Ω–Ω—ã–µ
await clearOfflineDB();
```

### Privacy Library

```javascript
import { 
    enablePrivacyMode,
    disablePrivacyMode,
    isPrivacyModeEnabled,
    sanitizeURL,
    clearSensitiveData,
    getPrivacyReport,
    encryptData,
    decryptData
} from './lib/privacy';

// –í–∫–ª—é—á–∏—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–π —Ä–µ–∂–∏–º
enablePrivacyMode();

// –û—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–π —Ä–µ–∂–∏–º
disablePrivacyMode();

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
if (isPrivacyModeEnabled()) {
    console.log('üîí Privacy mode active');
}

// –û—á–∏—Å—Ç–∏—Ç—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
await clearSensitiveData();

// –ü–æ–ª—É—á–∏—Ç—å –æ—Ç—á—ë—Ç –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏
const report = await getPrivacyReport();
console.log(report);
// {
//   privacyModeEnabled: true,
//   settings: {...},
//   sessionStorageSize: 1024,
//   localStorageSize: 2048,
//   cookieCount: 5,
//   timestamp: '2025-01-15T10:30:00.000Z'
// }

// –°–∞–Ω–∏—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å URL (—É–¥–∞–ª–∏—Ç—å tracking –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
const cleanUrl = sanitizeURL('https://example.com?utm_source=google&fbclid=123');
// Returns: 'https://example.com'

// –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (–¥–ª—è –æ—á–µ–Ω—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏)
const key = await deriveKey('password');
const encrypted = await encryptData('Secret data', key);
const decrypted = await decryptData(encrypted, key);
```

## API –ò–∑–º–µ–Ω–µ–Ω–∏—è

–í—Å–µ API –∑–∞–ø—Ä–æ—Å—ã —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –ü—Ä–æ–≤–µ—Ä—è—é—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π –∫—ç—à (–µ—Å–ª–∏ –Ω–µ –æ—Ç–∫–ª—é—á–µ–Ω skipCache)
2. –ü—Ä–∏ —É—Å–ø–µ—Ö–µ - —Å–æ—Ö—Ä–∞–Ω—è—é—Ç –¥–∞–Ω–Ω—ã–µ –≤ IndexedDB –¥–ª—è offline –¥–æ—Å—Ç—É–ø–∞
3. –ü—Ä–∏ –æ—à–∏–±–∫–µ –∏ –µ—Å–ª–∏ device offline - –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (–∏—Å—Ç–æ—Ä–∏—è, –ø–æ—á–∞—Å–æ–≤–æ–π –≥—Ä–∞—Ñ–∏–∫, –º–∞—Ä–∫–µ—Ä—ã) –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ:
```javascript
getHistory()  // skipCache=true - –≤—Å–µ–≥–¥–∞ —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ
getHourly()   // skipCache=true - –≤—Å–µ–≥–¥–∞ —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ
getMarkers()  // skipCache=true - –≤—Å–µ–≥–¥–∞ —Å–≤–µ–∂–∏–µ –º–∞—Ä–∫–µ—Ä—ã
```

## PrivacyPanel –ö–æ–º–ø–æ–Ω–µ–Ω—Ç

–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤–Ω–∏–∑—É —Å–ø—Ä–∞–≤–∞ —ç–∫—Ä–∞–Ω–∞:

```jsx
<PrivacyPanel theme="dark" />
```

### –§—É–Ω–∫—Ü–∏–∏ –ø–∞–Ω–µ–ª–∏:
- üì° **–°—Ç–∞—Ç—É—Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è** - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–Ω–ª–∞–π–Ω/–æ—Ñ–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å
- üîê **Privacy toggle** - –≤–∫–ª—é—á–∏—Ç—å/–æ—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–π —Ä–µ–∂–∏–º
- üìä **Offline stats** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –∏ —Ä–∞–∑–º–µ—Ä
- üîÑ **Sync button** - –≤—Ä—É—á–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å —á—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å)
- üßπ **Clear data** - —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- üìã **Privacy report** - —Å–≤–µ–¥–µ–Ω–∏—è –æ —Ä–∞–∑–º–µ—Ä–µ –∫—ç—à–∞ –∏ cookies

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—Å–ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –æ—Ñ–ª–∞–π–Ω –∏ –ø–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

```javascript
import { isOnline, addOnlineListener } from './lib/offline';

useEffect(() => {
    addOnlineListener((online) => {
        if (!online) {
            showNotification('üì° –í—ã –≤ –æ—Ñ–ª–∞–π–Ω–µ. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.');
        }
    });
}, []);
```

### –ü—Ä–∏–º–µ—Ä 2: –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```javascript
import { clearSensitiveData, isPrivacyModeEnabled } from './lib/privacy';

const handleLogout = async () => {
    if (isPrivacyModeEnabled()) {
        await clearSensitiveData();
    }
    // ... logout code
};
```

### –ü—Ä–∏–º–µ—Ä 3: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞

```javascript
import { syncPendingActions, addOnlineListener } from './lib/offline';

addOnlineListener(async (isOnline) => {
    if (isOnline) {
        console.log('üì§ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é –æ–∂–∏–¥–∞—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è...');
        await syncPendingActions();
    }
});
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### IndexedDB Schema

**Store: `pages`** - –∫—ç—à API responses
- Key: URL string
- Fields: `url`, `data`, `timestamp`
- Index: `timestamp`

**Store: `syncQueue`** - –æ—á–µ—Ä–µ–¥—å –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- Key: auto-increment ID
- Fields: `action`, `data`, `timestamp`, `synced`

### Performance 

- Offline database –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –î–∞–Ω–Ω—ã–µ –∫—ç—à–∏—Ä—É—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç UI)
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ñ–æ–Ω–µ –∫–æ–≥–¥–∞ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –ø–æ—è–≤—Ç–æ—Ä–∞–µ—Ç—Å—è
- –ú–∞–∫—Å–∏–º—É–º 100 –∑–∞–ø–∏—Å–µ–π –≤ –ø–∞–º—è—Ç–∏-–∫—ç—à–µ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è —Å—Ç–∞—Ä—ã–µ)

### –ë—Ä–∞—É–∑–µ—Ä –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- ‚úÖ Chrome/Edge 24+
- ‚úÖ Firefox 13+
- ‚úÖ Safari 10+
- ‚úÖ iOS Safari 10+
- ‚úÖ Android Browser 4.4+

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–∞–∂–Ω–æ –¥–ª—è iOS:**
- –ù–∞ iOS Safari private mode –æ—á–∏—â–∞–µ—Ç IndexedDB –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤ iOS app –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Capacitor storage plugin
- Web Crypto API —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ HTTPS (localhost –¥–ª—è development)

## Troubleshooting

### Offline cache –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
```javascript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—Å–ª–∏ IndexedDB –¥–æ—Å—Ç—É–ø–Ω–∞
import { initOfflineDB } from './lib/offline';
await initOfflineDB(); // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –æ—à–∏–±–∫–∏
```

### Privacy mode –Ω–µ –æ—á–∏—â–∞–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
```javascript
// –í—Ä—É—á–Ω—É—é –æ—á–∏—Å—Ç–∏—Ç—å
import { clearSensitiveData } from './lib/privacy';
await clearSensitiveData();
```

### –î–∞–Ω–Ω—ã–µ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è
```javascript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—á–µ—Ä–µ–¥—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
import { getPendingSyncActions } from './lib/offline';
const pending = await getPendingSyncActions();
console.log('Pending actions:', pending);
```

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- üîÑ Service Worker –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ offline —Ä–µ–∂–∏–º–∞
- üîê End-to-end encryption –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- üìä Analytics –≤ privacy mode (local only)
- üåê Automatic sync scheduling
